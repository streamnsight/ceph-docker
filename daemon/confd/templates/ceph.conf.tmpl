# Created and Maintained by Confd

[global]
  fsid = {{getv "/auth/fsid"}}
{{ if exists "/auth/cephx"}}
  auth_cluster_required = cephx
  auth_service_required = cephx
  auth_client_required = cephx
  {{if exists "/auth/cephx_require_signatures"}}
  cephx_require_signatures = {{getv "/auth/cephx_require_signatures"}} # Kernel RBD does NOT support signatures!
  {{else}}
  cephx_require_signatures = false
  {{end}}
  {{if exists "/auth/cephx_cluster_require_signatures"}}
  cephx_cluster_require_signatures = {{getv "/auth/cephx_cluster_require_signatures"}}
  {{else}}
  cephx_cluster_require_signatures = true
  {{end}}
  {{if exists "/auth/cephx_service_require_signatures"}}
  cephx_service_require_signatures = {{getv "/auth/cephx_service_require_signatures"}}
  {{else}}
  cephx_service_require_signatures = false
  {{end}}
{{else}}
  auth cluster required = none
  auth service required = none
  auth client required = none
  auth supported = none
{{end}}
{{ range $i, $k := ls "/global" }}
    {{ if not $i }}
      # dir exists, not empty, we're at index 0 (which is boolean false)
      # do something once
      {{range gets "/global/*"}}
        {{base .Key}} = {{.Value}}{{end}}
    {{ end }}
{{ end }}

[mon]
{{ range $i, $k := ls "/mon" }}
    {{ if not $i }}
      # dir exists, not empty, we're at index 0 (which is boolean false)
      # do something once
      {{range gets "/mon/*"}}
        {{base .Key}} = {{.Value}}{{end}}
    {{ end }}
{{ end }}
{{ range $i, $k := ls "/mon_host" }}
    {{ if not $i }}
      # dir exists, not empty, we're at index 0 (which is boolean false)
      # do something once
      {{range gets "/mon_host/*"}}
          [mon.{{base .Key}}]
            host = {{base .Key}}
            mon_addr = {{.Value}}{{end}}
    {{ end }}
{{ end }}

[osd]
{{ range $i, $k := ls "/osd" }}
    {{ if not $i }}
      # dir exists, not empty, we're at index 0 (which is boolean false)
      # do something once
      {{range gets "/osd/*"}}
        {{base .Key}} = {{.Value}}{{end}}
    {{ end }}
{{ end }}

[mds]
{{ range $i, $k := ls "/msd" }}
    {{ if not $i }}
      # dir exists, not empty, we're at index 0 (which is boolean false)
      # do something once
      {{range gets "/mds/*"}}
        {{base .Key}} = {{.Value}}{{end}}
    {{ end }}
{{ end }}

[client]
{{ range $i, $k := ls "/msd" }}
    {{ if not $i }}
      # dir exists, not empty, we're at index 0 (which is boolean false)
      # do something once
      {{range gets "/client/*"}}
        {{base .Key}} = {{.Value}}{{end}}
    {{ end }}
{{ end }}
